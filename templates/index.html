<!DOCTYPE html>
<html>

<head>
    <style>
        .vertical-center {
            margin: 0;
            position: absolute;
            top: 50%;
            -ms-transform: translateY(-50%);
            transform: translateY(-50%);
        }

        .button {
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 60px;
            margin: 10px 10px;
            cursor: pointer;
        }

        .record {
            background-color: #4CAF50;
        }

        /* Green */
        .stop {
            background-color: #800000;
        }

        /* Red */
        .connect {
            background-color: #000080;
        }

        /* Blue */
        .check {
            background-color: #800080;
        }

        /* Pruple */
        .normal {
            background-color: #4CAF50;
        }

        /* Green */
        .squeak {
            background-color: #800000;
        }

        /* Red */
        .rattle {
            background-color: #000080;
        }

        /* Blue */
        .both {
            background-color: #800080;
        }

        .label {
  white-space: pre-wrap;
}

        /* Pruple */


        /* p {
    font-size: 15px
} */
    </style>
</head>

<body>
    <div class="vertical-center">
        <!-- Page content -->
        <button onclick='scanvin()' class='button record'>scan VIN</button></br>

        <div id="qr-reader" style="width: 100%"></div></br>

        <button id="vinbutton" class='button record'>VIN not set</button></br>

        <button onclick='run(0)' class='button record'>record</button>
        <button onclick='run(1)' class='button stop'>stop</button></br>
        <button onclick='vpn(0)' class='button connect'>connect VPN</button>
        <button onclick='vpn(1)' class='button check'>check VPN</button></br>
        <button onclick='report(0)' class='button normal'>normal</button>
        <button onclick='report(1)' class='button squeak'>squeak</button>
        <button onclick='report(2)' class='button rattle'>rattle</button>
        <button onclick='report(3)' class='button both'>both</button></br>

        <label id="message" class="label">No Messages</label>
    </div>

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript">


    </script>
    <script>

        var vin = '';

        const cmds = ["record", "stop"];

        function run(i) {
            const xhttp = new XMLHttpRequest();
            if (vin == '') {
                document.getElementById("message").innerHTML = 'Please scan to get a VIN at first';
            } else {
                xhttp.open("GET", "/" + cmds[i] + "/" + vin);
                xhttp.onload = function () {
                    document.getElementById("message").innerHTML = this.responseText;
                }
                xhttp.send();
            }
        }

        const vpn_cmds = ["connect-vpn", "check-vpn"];
        function vpn(i) {
            const xhttp = new XMLHttpRequest();
            xhttp.open("GET", "/" + vpn_cmds[i]);
            xhttp.onload = function () {
                document.getElementById("message").innerHTML = this.responseText;
            }
            xhttp.send();
        }

        const report_cmds = ["normal", "squeak", "rattle", "both"]
        function report(i) {
            const xhttp = new XMLHttpRequest();
            xhttp.open("GET", "/report/" + vin + "/" + report_cmds[i]);
            xhttp.onload = function () {
                document.getElementById("message").innerHTML = this.responseText;
            }
            xhttp.send();
        }

        function onScanSuccess(decodedText, decodedResult) {
            console.log(`Code scanned = ${decodedText}`, decodedResult);
            vin = decodedText;
            document.getElementById("vinbutton").innerHTML = 'VIN: ' + vin;
            html5QrcodeScanner.clear();
        }

        let qrboxFunction = function (viewfinderWidth, viewfinderHeight) {
            let minEdgePercentage = 0.7; // 70%
            let minEdgeSize = Math.min(viewfinderWidth, viewfinderHeight);
            let qrboxSize = Math.floor(minEdgeSize * minEdgePercentage);
            return {
                width: qrboxSize,
                height: qrboxSize / 2
            };
        }

        function scanvin() {
            console.log('scan vin')
            html5QrcodeScanner.render(onScanSuccess);
        }

        var html5QrcodeScanner = new Html5QrcodeScanner("qr-reader", { fps: 10, qrbox: qrboxFunction });

    </script>

</body>

</html>